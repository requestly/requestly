import React, { useCallback, useState } from "react";
import { KeyValuePair } from "features/apiClient/types";
import { useQueryParamStore } from "features/apiClient/hooks/useQueryParamStore";
import { useAutogenerateStore } from "features/apiClient/hooks/useAutogenerateStore";
import { useScopedVariables } from "features/apiClient/helpers/variableResolver/variable-resolver";
import { KeyValueTable } from "../KeyValueTable/KeyValueTable";
import { AutoGeneratedTable } from "../KeyValueTable/AutoGeneratedTable";
import { BufferedHttpRecordEntity } from "features/apiClient/slices/entities";
import { useApiClientSelector } from "features/apiClient/slices/hooks/base.hooks";

interface QueryParamsTableProps {
  entity: BufferedHttpRecordEntity,
  // recordId: string;
  // onQueryParamsChange: (queryParams: KeyValuePair[]) => void;
}

function Data(props: {
  entity: BufferedHttpRecordEntity,
  // recordId: string;
  // queryParams: KeyValuePair[];
  // handleUpdateQueryParams: (updatedPairs: KeyValuePair[]) => void;
}) {
  const {entity} = props;
  const queryParams = useApiClientSelector(s => entity.getQueryParams(s));
  const scopedVariables = useScopedVariables(entity.meta.referenceId);
  const [showDescription, setShowDescription] = useState(false);
  return (
    <KeyValueTable
      data={queryParams}
      variables={scopedVariables}
      onChange={entity.setQueryParams.bind(entity)}
      extraColumns={{
        description: {
          visible: showDescription,
          onToggle: (show: any) => {
            setShowDescription(show);
          },
        },
        dataType: { visible: true },
      }}
    />
  );
}

export const QueryParamsTable: React.FC<QueryParamsTableProps> = React.memo(({ entity }) => {
  // const [queryParams, setQueryParams] = useQueryParamStore((state) => [state.queryParams, state.setQueryParams]);
  // const [getAllQueryParams] = useAutogenerateStore((s) => [s.getAllQueryParams]);

  // const queryParams = useApiClientSelector(s => entity.getQueryParams(s));

  // // const autogeneratedQueryParams = getAllQueryParams();
  // const handleUpdateQueryParams = useCallback(
  //   (updatedPairs: KeyValuePair[]) => {
  //     entity.setQueryParams(updatedPairs);
  //     // setQueryParams(updatedPairs);
  //     // onQueryParamsChange(updatedPairs);
  //   },
  //   []
  // );
      // {autogeneratedQueryParams.length > 0 && <AutoGeneratedTable data={autogeneratedQueryParams} type="queryParams" />}

  return (
    <div>
      <Data entity={entity} />
    </div>
  );
});
